\section{Développement du schéma électronique} \label{sec:Dev-Schematique}
Dans cette section, nous décrirons la phase principale du développement ainsi que la démarche suivie pour élaborer le schéma électronique du projet.

\subsection{Blocs développés} \label{ssec:Dev-blocs}
Pour faciliter le développement et la lecture du schéma, il est judicieux de diviser le système en plusieurs blocs. Une structure a ainsi été définie, divisant le circuit en trois blocs principaux : \hyperref[ssec:Dev-MCU]{\textbf{Microcontrôleur \ref{ssec:Dev-MCU}}} (Intelligence du système, connexion du programmeur et LED de vie.), \hyperref[ssec:Dev-Devices]{\textbf{Périphériques \ref{ssec:Dev-Devices}}} (\gls{GNSS}, \gls{imu}, \gls{FTDI}, connecteur USB, Carte SD.) et \hyperref[ssec:Dev-Alim]{\textbf{Alimentations \ref{ssec:Dev-Alim}}} (Connecteur batterie, gestion de charge, régulateurs de tension et système ON/OFF.).

Nous pouvons sur la figure \ref{fig:blocs} observer les différentes interaction entre les blocs, elles sont par la suite décrites dans le tableau \ref{tab:descrConnexion}.

\begin{figure}[h]
	\centering
	\includegraphics[width=.95\linewidth]{../figures/etude/sch/BLOCS}
	\caption{Blocs du système}
	\source{Auteur}
	\label{fig:blocs}
\end{figure}

\begin{center}
	\underline{Tableau des interaction entre les blocs}
	\begin{table}[h]
		\centering
		\resizebox{\columnwidth}{!}{%
			\begin{tabular}{l|l}
				Connexion/s & Description \\
				\hline
				INT\_IMU & Interruption de la centrale inertielle, informe le \gls{mcu} et peut allumer le système. \\ 
				RST\_IMU & Permet de réinitialiser la \gls{imu}. \\
				PWR\_HOLD & Le \gls{mcu} peut se maintenir alimenté par cette connexion. \\
				BAT\_STAT & Fournit le statut de la batterie au \gls{mcu}. \\
				Button\_MF & Fournit le niveau logique du bouton au \gls{mcu}. \\
				BAT\_READ & Le \gls{mcu} peut activer la lecture de la tension de la batterie. \\
				BAT\_LVL & Lecture analogique de la tension de batterie. \\
				SDA1, SCL1 & Communication I2C avec l'\gls{imu}. \\
				SDA2, SCL2 & Communication I2C optionnelle avec le \gls{GNSS}. \\
				U1TX/RX... & Communication UART avec le \gls{FTDI} pour l'USB. \\
				U2TX/RX & Communication UART avec le \gls{GNSS}. \\
				RESET\_N & Permet de réinitialiser le \gls{GNSS}. \\
				SCK, MOSI... & Communication SPI avec la carte SD. \\ 
				R1,2,3,4 & Résistances de PULL-UP pour communication I2C. \\
			\end{tabular}
		}
		\caption{Description des connexions}
		\label{tab:descrConnexion}
	\end{table}
\end{center}

\clearpage

\subsection{Microcontrôleur} \label{ssec:Dev-MCU}

\subsubsection{Connexion} 
Pour utiliser le microcontrôleur, il est nécessaire de définir ses entrées/sorties en se référant à son \gls{datasheet}. Ce dernier permet de connaître les connexions dédiées à certains bus de communication ou à des entrées analogiques. 

\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.6\textwidth}
		\centering
		\includegraphics[width=1\linewidth]{../figures/etude/sch/MCU}
		\caption{Connexions du microcontrôleur}
		\label{fig:mcu}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\includegraphics[width=1\linewidth]{../figures/etude/sch/MCU-HARMONY}
		\caption{Config. \gls{harmony}.}
		\label{fig:mcu-harmony}
	\end{subfigure}
	\hfill
	\caption{Configuration des PINs du microcontrôleur}
	\source{Auteur}
	\label{fig:sch-connMcu}
\end{figure}

Pour valider les connexions de la figure \ref{fig:mcu}, une vérification a été réalisée à l'aide du configurateur graphique \gls{harmony}, comme le montre la figure \ref{fig:mcu-harmony}. Cette étape a confirmé la possibilité d'attribuer certaines fonctions à des PINs spécifiques. Les PINs non utilisées du microcontrôleur sont redirigées vers un connecteur. Dans le contexte du prototype, cela permet de les exploiter ailleurs sur la carte.


\subsubsection{Programmateur et reset} 

\begin{figure}[h]
	\centering
	\includegraphics[width=.9\linewidth]{../figures/etude/sch/Prog-Reset}
	\caption{Schéma programmateur et reset}
	\source{Auteur}
	\label{fig:prog-reset}
\end{figure}

Sur la figure \ref{fig:prog-reset}, nous pouvons observer le connecteur de programmation \textit{P3}. La connexion \textbf{MCLR} (Master Clear), qui permet de réinitialiser le \gls{mcu} lors de sa programmation, est suivie d'un circuit de protection du \gls{mcu} et d'un bouton pour permettre une réinitialisation manuelle.

\clearpage

\subsubsection{LED de vie} 

\begin{figure}[h]
	\centering
	\includegraphics[width=.9\linewidth]{../figures/etude/DIM-LED}
	\caption{Données de la LED}
	\source{\gls{datasheet} \href{https://docs.broadcom.com/doc/ASMB-KTF0-0A306-DS100}{ASMB-KTF0-0A306}}
	\label{fig:dim-led}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[width=0.4\linewidth]{../figures/etude/sch/LED-Vie}
	\caption{Schéma de la LED de vie}
	\source{Auteur}
	\label{fig:led-vie}
\end{figure}

Les résistances de la figure \ref{fig:led-vie} ont été dimensionnées en respectant les caractéristiques des LEDs pour chacune des couleurs (voir figure \ref{fig:dim-led}). Ces dernières éclairent à 80\% de leur luminosité nominale dans un souci d'économie d'énergie, leur utilité étant réduite à ce stade de prototypage.

\begin{center}
	\underline{Exemple dimensionnement résistance LED bleue}
	\begin{equation*}
		R_{blue} = \frac{(Vcc - V_{blue})}{I_b} = \frac{(3.3 - 2.85)}{12*10^-3} = 37.5 \Omega
	\end{equation*}
\end{center}

\clearpage

\subsection{Périphériques} \label{ssec:Dev-Devices}
Dans cette section, nous allons décrire les schématiques des périphériques du système.
 
\subsubsection{Carte SD}

\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\linewidth]{../figures/etude/sch/Carte-SD}
	\caption{Branchement carte SD}
	\source{Auteur}
	\label{fig:carte-sd}
\end{figure}

La carte SD de la figure \ref{fig:carte-sd} est branchée en respectant la connectique pour une communication SPI simple. De plus, un condensateur est connecté entre \textbf{SCK} et \textbf{GND}. Toutefois, ce condensateur ne sera pas monté sauf si un filtrage sur la ligne de clock s'avère nécessaire.


\subsubsection{Centrale inertielle}

\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\linewidth]{../figures/etude/sch/IMU}
	\caption{Schéma centrale inertielle}
	\source{Auteur}
	\label{fig:imu}
\end{figure}

La centrale inertielle, étant déjà montée sur une carte d'extension, ne nécessite pas de composants passifs additionnels. Trois résistances de PULL-DOWN sont présentes, respectivement sur \textbf{ADR}, \textbf{PS0} et \textbf{PS1}. Elles permettent de configurer l'adresse et l'interface de communication de l'\gls{imu}. De plus, un jumper\footnote{Connecteur permettant de faire ou de rompre une connexion.} est présent sur les alimentations. Ceci permet de choisir si la centrale inertielle est alimentée indépendamment du reste du système (pour pouvoir l'allumer séparément) ou avec la même alimentation que le reste du système.


\subsubsection{GNSS}
\begin{figure}[h]
	\centering
	\includegraphics[width=.6\linewidth]{../figures/etude/sch/GNSS}
	\caption{Schéma du \gls{GNSS}}
	\source{Auteur}
	\label{fig:gnss}
\end{figure}

Le \gls{GNSS} est connecté selon un schéma présenté dans son \href{https://www.u-blox.com/sites/default/files/CAM-M8-FW3_HIM_%28UBX-15030063%29.pdf}{Hardware Integration Manual}, à la section \textbf{2.2}. Ce schéma représente un design minimal pour recevoir des données via l'interface UART. Par rapport à la figure \ref{fig:gnss}, les différences sont les suivantes : l'interface I2C est également disponible, la PIN \textbf{RESET\_N} est connectée au \gls{mcu} et les PINS non-utilisées sont reliées à un connecteur afin de permettre leur utilisation éventuelle dans le cadre du prototype.

\subsubsection{USB - FTDI}

\begin{figure}[h]
	\centering
	\includegraphics[width=.8\linewidth]{../figures/etude/sch/USB-FTDI}
	\caption{Schéma connecteur USB et FTDI}
	\source{Auteur}
	\label{fig:usb-ftdi}
\end{figure}

Le schéma du connecteur USB-C est conçu pour présenter une résistance aux interférences. Son signal 5V est filtré par une \textit{ferrite bead}. Les pistes différentielles de l'USB sont ensuite reliées au module \gls{FTDI}, qui est interfacé en UART et est alimenté par l'USB.

\clearpage

\subsection{Alimentations} \label{ssec:Dev-Alim}
Dans cette section, nous allons décrire les fonctionnement et dimensionnements principaux du bloc alimentation comprenant les différents régulateurs et la batterie.

\subsubsection{Chargeur de batterie} \label{sssec:Chargeur-bat}

\begin{figure}[h]
	\centering
	\includegraphics[width=.85\linewidth]{../figures/etude/sch/CHRG-BAT}
	\caption{Schéma chargeur de batterie}
	\source{Auteur}
	\label{fig:chrg-bat}
\end{figure}

Le composant \textbf{MCP73871T-2CCI/ML} peut être configuré pour fournir un courant de charge programmable à la batterie. Ce courant est divisé en deux parties : la charge normale et la charge de terminaison, cette dernière intervenant lorsque la batterie est proche de sa pleine capacité.
Afin de calculer ces courants, il faut se servir de la capacité de la batterie et de ratios quant à celle-ci.



\subsubsection{Système d'enclenchement} \label{sssec:On-OFF}

\subsection{Adaptation mécanique} \label{sssec:Adaptation-mech}

\subsection{Synthèse et perspectives de l'étude} \label{ssec:Synth-etude}